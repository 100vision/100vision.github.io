---
# 这是文章的标题
title: Windows：特殊账户管理：了解服务账户、虚拟账户和可管理服务账户
# 这是页面的图标
icon: page
# 这是侧边栏的顺序
order: 43
# 设置作者
# 设置写作时间
date: 2023-06-27
# 一个页面可以有多个分类
category:
  - Windows
  - 系统管理

# 一个页面可以有多个标签
tag:
  - SQLServer
  - Windows
  - 服务账户
  - 服务账户管理


  



# 此页面会在文章列表置顶
sticky: false
# 此页面会出现在文章收藏中
star: true

---

:::tip 背景
了解Windows如何更好地管理服务账户，特别是服务账户的密码管理。按照以往的经验，服务账户都是管理员手动创建和管理密码生命周期。一般情况下，为保证服务稳定，管理员在没有安全审计强制要求下，不会更新服务账户密码，但这样长久不更新密码存在安全隐患。微软提供的特殊服务账户可以交由系统自动更新和管理密码。
:::

## 了解Windows服务账户

### 服务账户特点

个人理解，服务账户(Service Account)是服务运行凭据，也是服务进程访问系统资源，网络资源等资源的凭据。一般有这些特点：

- 使用范围都是特定的，专用于某个服务，不共享使用；
- 不常更新密码 （保证服务稳定）
- 权限都比较低 （最小权限原则，降低安全风险）；

### Windows服务账户使用范围

- 使用于Windows服务，即通过Service管理单元管理。
- 使用于非Windows平台上的服务，用来访问Windows系统系统、网络资源。例如Linux下访问Windows共享或是Active Directory资源。

### Windows服务账户的管理方式

- 通过管理员手动管理。
- 通过系统托管管理服务账户。系统自动更新密码；

**1、通过管理员手动管理**

> 这是传统的管理方法,不展开介绍。

好处：适用范围更广，支持各种服务账户运行场景，例如，Windows原生服务不用说，也适用于Linux平台、网络设备上。

不足：管理麻烦。管理手动创建服务账户、管理密码、指定服务账户的权限等，给管理员带来更多管理负担。

**2、通过系统托管管理**

> 这是本文要重点介绍的方法，即虚拟服务账户和可管理的服务账户。

好处：更少的管理任务，密码自动更新，安全性更强。

不足: 适用范围小，仅支持Windows服务；不适用其他平台下的服务。


## 托管Windows服务账户

> 以上了解到Windows服务账户可以交由系统托管，减少管理任务，提高安全性，但也有局限性。

### 了解托管Windows服务账户

**有3种托管服务账户**

- 虚拟账户 （Virtual Account or Local Managed Account)
- 普通可管理服务账户(Standalone Managed Service Account, MSA)
- 组可管理服务账户（ Group-Managed Service Account,gMSA)

**虚拟账户 Virtual Account**

> 虚拟服务账户，又称Local Managed Account，是Windows Server 2008 R2和Windows 7引入，特点有：

- 它们是本地系统账户，不是域账户。账户名格式 NT SERVICE\<SERVICENAME>.
- 它们可以访问域环境资源，是通过域计算机账户身份访问网络资源的, 例如MyDomain\mycomputer$
- 不需要管理密码；



> 虚拟账户的创建一般都是由Windows应用程序安装时创建生成的。例如SQL Server下有：

- NT SERVICE\MSSQLSERVER  （数据库引擎服务使用）
- NT Service\SQLSERVERAGENT （SQL Agent服务使用）

> 虚拟服务账户的权限分配。一般情况下，服务默认使用虚拟服务账户凭据运行，本着最小权限运行服务的最佳实践。但有时需要访问一些本地特殊系统资源，则可以额外授权。或是改用其他服务账户类型，即以下的MSA或gMSA。

> 虚拟服务账户的授权方法。本地资源授权时，授权目标是虚拟服务账户名，网络资源授权时，授权目标是虚拟账户所在的计算机账户，例如MyDomain\mySQLServerHost$

:::tip
虚拟账户在本地计算机账户管理中看不到的，在授权时可以直接输入账户名。
:::
