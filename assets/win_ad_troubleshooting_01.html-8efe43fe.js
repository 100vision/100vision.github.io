import{_ as t,W as r,X as l,Z as e,$ as i,a0 as a,Y as n,G as s}from"./framework-2e6688e7.js";const d={},c=n('<h2 id="症状" tabindex="-1"><a class="header-anchor" href="#症状" aria-hidden="true">#</a> 症状</h2><ul><li>最初是发现组策略不同步到所有域控。进而发现sysvol文件夹在域控之间不同步。</li><li>又在域控的DFS管理中发现DFSR SysVol (Domain Sysvol Volumes）复制组消失！</li></ul><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景" aria-hidden="true">#</a> 背景</h2><ul><li>DC域控都是从Windows Server 2008升级到Windows Server 2016.</li><li>2个站点多域控制器；</li><li>Sysvol复制协议几个月前从FRS升级到了DFSr</li></ul><h2 id="问题影响" tabindex="-1"><a class="header-anchor" href="#问题影响" aria-hidden="true">#</a> 问题影响</h2><ul><li>主要是影响组策略无法下发因为sysvol文件不同步；</li></ul><h2 id="排错步骤" tabindex="-1"><a class="header-anchor" href="#排错步骤" aria-hidden="true">#</a> 排错步骤</h2><ul><li><p>在所有域控上，使用<code>dcdiag /test:sysvolcheck /e</code> 检查SysVol也没有报任何错误；看起来正常；</p></li><li><p>在所有域控上，使用<code>repadmin /syncall /AedP</code>立刻同步一次，没有变化; <code>repladmin /replsummary</code> 也没看到任何错误；</p></li><li><p>考虑到SysVol是使用DFS协议同步，检查事件查看器里的DFS日志，没有发现类似event id <code>2212</code>（指示DFS数据库脏关闭的信息）；</p></li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>DFS数据库不正常关闭可能导致DFS停止复制。一般事件日志可以看懂2212或2213等event ID。</p></div><ul><li>使用WMIC检查数据库健康，输出<code>没有可用实例</code> 或 <code>no available instance(s).</code></li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>可以使用 <code>Wmic /namespace:\\\\root\\microsoftdfs path dfsrreplicatedfolderinfo get replicationgroupname,replicatedfoldername,state</code> 检查数据库状态。如果看到数据库状态异常，DFS停止复制，可以使用 <code>wmic /namespace:\\\\root\\microsoftdfs path dfsrVolumeConfig where volumeGuid=&lt;GUID&gt; call ResumeReplication</code> 恢复复制。</p></div><ul><li>问题好像比较严重，感觉有点无助。</li></ul><h2 id="解决办法" tabindex="-1"><a class="header-anchor" href="#解决办法" aria-hidden="true">#</a> 解决办法：</h2><p>（以后填坑）</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2>',15),h={href:"https://community.spiceworks.com/how_to/160786-how-to-re-build-sysvol-dfsr-replication-group-without-demoting-promoting-dc",target:"_blank",rel:"noopener noreferrer"},p={href:"https://serverfault.com/questions/745599/deleted-domain-system-volume-how-do-i-recreate-it-i-have-no-backups",target:"_blank",rel:"noopener noreferrer"};function u(m,f){const o=s("ExternalLinkIcon");return r(),l("div",null,[c,e("p",null,[e("a",h,[i("https://community.spiceworks.com/how_to/160786-how-to-re-build-sysvol-dfsr-replication-group-without-demoting-promoting-dc"),a(o)])]),e("p",null,[e("a",p,[i("https://serverfault.com/questions/745599/deleted-domain-system-volume-how-do-i-recreate-it-i-have-no-backups"),a(o)])])])}const v=t(d,[["render",u],["__file","win_ad_troubleshooting_01.html.vue"]]);export{v as default};
