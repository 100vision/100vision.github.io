import{_ as r,W as n,X as i,Z as e,$ as t,a0 as s,Y as o,G as c}from"./framework-b5535326.js";const l="/assets/post57_ex_autodiscovery-e75ca9bf.jpg",d={},u=o('<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>Outlook的Autodiscovery功能可以实现Exchange邮箱自动配置。启动Outlook时根据邮箱地址自动发现企业组织的Exchange服务器和邮箱配置，用户无需输入、也不需要知道服务器地址等，很方便。</p><h2 id="自动发现介绍" tabindex="-1"><a class="header-anchor" href="#自动发现介绍" aria-hidden="true">#</a> 自动发现介绍</h2><blockquote><p>Exchange Server/Outlook自动发现服务。Outlook怎么定位Exchange服务器服务端点Url，主要会尝试以下方式。关于尝试顺序，会根据Outlook版本不同而不同：</p></blockquote><h3 id="_1-scp-object-lookup" tabindex="-1"><a class="header-anchor" href="#_1-scp-object-lookup" aria-hidden="true">#</a> 1. SCP object lookup</h3><p>Outlook performs an Active Directory query for <code>Service Connection Point</code> (SCP) objects.</p>',6),p={href:"https://learn.microsoft.com/en-us/windows/win32/ad/publishing-with-service-connection-points?redirectedfrom=MSDN",target:"_blank",rel:"noopener noreferrer"},h=o('<h3 id="_2-root-domain-query-based-on-your-primary-smtp-address" tabindex="-1"><a class="header-anchor" href="#_2-root-domain-query-based-on-your-primary-smtp-address" aria-hidden="true">#</a> 2. Root domain query based on your primary SMTP address</h3><p>Outlook uses the root domain of your primary SMTP address to try to locate the AutoDiscover service. Outlook tries to connect to the following URL based on your SMTP address:</p><p><code>https://&lt;smtp-address-domain&gt;/autodiscover/autodiscover.xml</code></p><h3 id="_3、query-for-the-autodiscover-domain" tabindex="-1"><a class="header-anchor" href="#_3、query-for-the-autodiscover-domain" aria-hidden="true">#</a> 3、Query for the AutoDiscover domain</h3><p>Outlook uses the AutoDiscover domain to try to locate the AutoDiscover service. Outlook tries to connect to the following URL based on your SMTP address:</p><p><code>https://autodiscover.&lt;smtp-address-domain&gt;/autodiscover/autodiscover.xml</code></p><h3 id="_4、http-redirect" tabindex="-1"><a class="header-anchor" href="#_4、http-redirect" aria-hidden="true">#</a> 4、HTTP redirect</h3><p>Outlook uses HTTP redirection if Outlook cannot reach the AutoDiscover service through either of the secure HTTPS URLS:</p><p><code>https://&lt;smtp-address-domain&gt;/autodiscover/autodiscover.xml</code></p><p><code>https://autodiscover.&lt;smtp-address-domain&gt;/autodiscover/autodiscover.xml</code></p><h3 id="_5、srv-record-query-in-dns" tabindex="-1"><a class="header-anchor" href="#_5、srv-record-query-in-dns" aria-hidden="true">#</a> 5、SRV record query in DNS</h3><p>Outlook uses an SRV record lookup in DNS to try to locate the AutoDiscover service.</p><h2 id="一般情况" tabindex="-1"><a class="header-anchor" href="#一般情况" aria-hidden="true">#</a> 一般情况</h2><ul><li>未加入域的电脑，一般Outlook会先尝试 will try to connect to the predefined URLs (such as <code>https://autodiscover.contoso.com/autodiscover/autodiscover.xml</code>) by using DNS</li><li>加入域的电脑，一般Outlook会先尝试 <code>SCP</code> 这个方式。先搜索AD目录中的SCP对象，这个对象返回值是组织内部的所有Exchange CAS服务器的自动发现服务端点URL，然后向第一个发起配置查询。 <ul><li>searches for the Autodiscover SCP objects. After the client obtains and enumerates the instances of the Autodiscover service, the client connects to the first Client Access server in the enumerated list and obtains the profile information in the form of XML data that&#39;s needed to connect to the user&#39;s mailbox and available Exchange features.</li></ul></li></ul><h2 id="特殊情况" tabindex="-1"><a class="header-anchor" href="#特殊情况" aria-hidden="true">#</a> 特殊情况</h2><p>管理员可以控制Outlook的自动发现方式和行为，详细参考以下</p><p>通过修改Oultook所在电脑的注册表中的autodiscover键，可以有选择的关闭自动自动发现行为：</p><ul><li>PreferLocalXML</li><li>PreferProvidedEmailInAutoDiscoverAuthPrompts</li><li>ExcludeHttpRedirect</li><li>ExcludeHttpsAutoDiscoverDomain</li><li>ExcludeHttpsRootDomain</li><li>ExcludeScpLookup</li><li>ExcludeSrvRecord</li><li>ExcludeLastKnownGoodURL (only applies to Outlook 2010 version 14.0.7140.5001 and later versions)</li><li>ExcludeExplicitO365Endpoint (only applies to Outlook 2016 version 16.0.6741.2017 and later versions)</li></ul><h2 id="扩展-如何控制outlook自动发现行为" tabindex="-1"><a class="header-anchor" href="#扩展-如何控制outlook自动发现行为" aria-hidden="true">#</a> 扩展： 如何控制Outlook自动发现行为</h2><p>使用Outlook组策略模板，详细参考：</p>',20),m={href:"https://learn.microsoft.com/en-us/outlook/troubleshoot/profiles-and-accounts/how-to-control-autodiscover-via-group-policy",target:"_blank",rel:"noopener noreferrer"},v=o('<h3 id="查看outlook当前使用的自动发现方式" tabindex="-1"><a class="header-anchor" href="#查看outlook当前使用的自动发现方式" aria-hidden="true">#</a> 查看Outlook当前使用的自动发现方式</h3><ul><li>Ctrl + 右键outlook, —&gt;&gt;&gt;测试配置，勾去”使用Guessmart和保护Guessstart身份验证“。</li><li>点击”测试“</li><li>查看日志</li></ul><p>以下示例，显示Outlook是<strong>通过SCP方式</strong> 定位到自动发现端点Url。</p><figure><img src="'+l+`" alt="Outlook Autodiscovery" tabindex="0" loading="lazy"><figcaption>Outlook Autodiscovery</figcaption></figure><h2 id="扩展-测试和检查exchange服务器的webservice" tabindex="-1"><a class="header-anchor" href="#扩展-测试和检查exchange服务器的webservice" aria-hidden="true">#</a> 扩展：测试和检查Exchange服务器的WebService</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>PS C:<span class="token punctuation">\\</span><span class="token operator">&gt;</span> Test-OutlookWebServices <span class="token parameter variable">-Identity</span> test_user <span class="token parameter variable">-MailboxCredential</span> <span class="token punctuation">(</span>Get-Credential<span class="token punctuation">)</span> <span class="token parameter variable">-TrustAnySSLCertificate</span>  <span class="token parameter variable">-ClientAccessServer</span> cas01.example.com

位于命令管道位置 <span class="token number">1</span> 的 cmdlet Get-Credential
请为以下参数提供值:
Credential

Source                              ServiceEndpoint                     Scenario                       Result  Latency
                                                                                                                  <span class="token punctuation">(</span>MS<span class="token punctuation">)</span>
------                              ---------------                     --------                       ------  -------
cas01.example.com        cas01.example.com       自动发现: Outlook 提供程序     Success      <span class="token number">35</span>
cas01.example.com        cas01.example.com       Exchange Web Services          Success      <span class="token number">14</span>
cas01.example.com        cas01.example.com       可用性服务                     Success      <span class="token number">71</span>
cas01.example.com        cas01.example.com       脱机通讯簿                     Success      <span class="token number">17</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function b(k,f){const a=c("ExternalLinkIcon");return n(),i("div",null,[u,e("p",null,[e("a",p,[t("https://learn.microsoft.com/en-us/windows/win32/ad/publishing-with-service-connection-points?redirectedfrom=MSDN"),s(a)])]),h,e("p",null,[e("a",m,[t("https://learn.microsoft.com/en-us/outlook/troubleshoot/profiles-and-accounts/how-to-control-autodiscover-via-group-policy"),s(a)])]),v])}const _=r(d,[["render",b],["__file","post57_msg_exchange_autodiscovery.html.vue"]]);export{_ as default};
