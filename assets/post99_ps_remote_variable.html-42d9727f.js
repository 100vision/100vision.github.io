import{_ as n,W as s,X as o,Z as e,$ as l,a0 as t,Y as p,G as r}from"./framework-b5535326.js";const c={},i=p(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p><code>Invoke-command</code>可以实现在远程系统上执行Powershell代码块。方式是<code>invoke-command -ScriptBlock { &lt;code&gt;}</code>。很多时候需要把本地变量传递到远程代码块 <code>-ScriptBlock</code>。</p><p>如果直接传递本地变量，会获取不到值。需要使用特殊方式。</p><h2 id="正文" tabindex="-1"><a class="header-anchor" href="#正文" aria-hidden="true">#</a> 正文</h2><h3 id="powershell-3-0以下版本" tabindex="-1"><a class="header-anchor" href="#powershell-3-0以下版本" aria-hidden="true">#</a> PowerShell 3.0以下版本</h3><blockquote><p>可以使用<code>-ArgumentList</code>关键字。</p></blockquote><ul><li>代码示例</li></ul><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code><span class="token variable">$ps</span> = <span class="token string">&quot;*PowerShell*&quot;</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>ComputerName S1 <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
  <span class="token keyword">param</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">)</span>
  <span class="token function">Get-WinEvent</span> <span class="token operator">-</span>LogName <span class="token variable">$log</span>
<span class="token punctuation">}</span> <span class="token operator">-</span>ArgumentList <span class="token variable">$ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>解释</strong></p><ul><li>把本地变量通过<code>ArgumentList</code>传递。</li><li>通过<code>param</code>接收。如果是多个变量，要注意确保传递的参数顺序与远程脚本块中 param 关键字定义的参数顺序一致</li></ul><h3 id="powershell-3-0以上版本" tabindex="-1"><a class="header-anchor" href="#powershell-3-0以上版本" aria-hidden="true">#</a> PowerShell 3.0以上版本</h3><ul><li>使用<code>$Using</code> 修饰符传递普通变量</li></ul><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code><span class="token variable">$ps</span> = <span class="token string">&quot;*PowerShell*&quot;</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>ComputerName S1 <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span>
  <span class="token function">Get-WinEvent</span> <span class="token operator">-</span>LogName <span class="token variable">$Using</span>:<span class="token function">ps</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用<code>@Using</code> 修饰符传递hash参数（多个变量）</li></ul><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code><span class="token variable">$Splat</span> = @<span class="token punctuation">{</span> Name = <span class="token string">&quot;Win*&quot;</span><span class="token punctuation">;</span> Include = <span class="token string">&quot;WinRM&quot;</span> <span class="token punctuation">}</span>
<span class="token function">Invoke-Command</span> <span class="token operator">-</span>Session <span class="token variable">$s</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span> <span class="token function">Get-Service</span> @<span class="token keyword">Using</span>:Splat <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2>`,16),d={href:"https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_remote_variables?view=powershell-5.1",target:"_blank",rel:"noopener noreferrer"};function u(h,k){const a=r("ExternalLinkIcon");return s(),o("div",null,[i,e("ul",null,[e("li",null,[e("a",d,[l("微软官方 about_Remote_Variables"),t(a)])])])])}const v=n(c,[["render",u],["__file","post99_ps_remote_variable.html.vue"]]);export{v as default};
